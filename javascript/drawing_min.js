var mouseisdown=false;var targets=new Array();var imgs=new Array();var targetOuts=new Array();var lines=new Array();var dots=new Array();var odots=new Array();var tplines=new Array();var tptypes=new Array();var ineqlines=new Array();var ineqtypes=new Array();var canvases=new Array();var drawla=new Array();var curLine=null;var drawstyle=[];var drawlocky=[];var curTPcurve=null;var curIneqcurve=null;var ineqcolors=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"];var ineqacolors=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"];var dragObj=null;var oldpointpos=null;var curTarget=null;var nocanvaswarning=false;function clearcanvas(a){lines[a].length=0;dots[a].length=0;odots[a].length=0;tplines[a].length=0;tptypes[a].length=0;ineqlines[a].length=0;ineqtypes[a].length=0;curTarget=a;drawTarget();curTarget=null;curLine=null;dragObj=null}function addTarget(p,j,f,m,a,g,o,e,d,q,l,n,c,k){var h=document.getElementById(j);var b=getPosition(h);targets[p]={el:h,left:b.x,top:b.y,width:h.offsetWidth,height:h.offsetHeight,xmin:a,xmax:g,ymin:o,ymax:e,imgborder:d,imgwidth:q,imgheight:l,mode:n,dotline:c};targetOuts[p]=document.getElementById(m);if(lines[p]==null){lines[p]=new Array()}if(dots[p]==null){dots[p]=new Array()}if(odots[p]==null){odots[p]=new Array()}if(tplines[p]==null){tplines[p]=new Array()}if(tptypes[p]==null){tptypes[p]=new Array()}if(ineqlines[p]==null){ineqlines[p]=new Array()}if(ineqtypes[p]==null){ineqtypes[p]=new Array()}if(n>=5){drawstyle[p]=1}else{drawstyle[p]=0}drawlocky[p]=k;imgs[p]=new Image();imgs[p].onload=function(){var r=curTarget;curTarget=p;drawTarget();curTarget=r};imgs[p].src=f}function settool(a,d,e){var c=document.getElementById("drawtools"+d);var f=c.getElementsByTagName("span");for(var b=0;b<f.length;b++){f[b].className=""}f=c.getElementsByTagName("img");for(var b=0;b<f.length;b++){f[b].className=""}a.className="sel";setDrawMode(d,e)}function setDrawMode(a,b){targets[a].mode=b}function setDotLine(b,a){targets[b].dotline=a}function drawTarget(l,h){try{var r=targets[curTarget].el.getContext("2d")}catch(G){if(!nocanvaswarning){nocanvaswarning=true;alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)")}}r.fillStyle="rgb(0,0,255)";r.lineWidth=2;r.strokeStyle="rgb(0,0,255)";r.clearRect(0,0,targets[curTarget].imgwidth,targets[curTarget].imgheight);r.drawImage(imgs[curTarget],0,0);r.beginPath();for(var v=0;v<ineqlines[curTarget].length;v++){var F=v%3;r.strokeStyle=ineqcolors[F];r.fillStyle=ineqcolors[F];var k=null;var A=null;var w=null;var c=null;var a=null;if(ineqlines[curTarget][v].length==3){A=ineqlines[curTarget][v][1][0];c=ineqlines[curTarget][v][1][1];w=ineqlines[curTarget][v][2][0];a=ineqlines[curTarget][v][2][1]}else{if(ineqlines[curTarget][v].length==2){A=ineqlines[curTarget][v][1][0];c=ineqlines[curTarget][v][1][1];w=l;a=h}else{if(curIneqcurve==v&&l!=null&&ineqlines[curTarget][v].length==1){A=l;c=h}}}if(w!=null){r.save();r.fillStyle=ineqacolors[F];r.beginPath();if(A!=ineqlines[curTarget][v][0][0]){var k=(c-ineqlines[curTarget][v][0][1])/(A-ineqlines[curTarget][v][0][0])}if(Math.abs(A-ineqlines[curTarget][v][0][0])<1||Math.abs(k)>100){r.moveTo(ineqlines[curTarget][v][0][0],0);r.lineTo(ineqlines[curTarget][v][0][0],targets[curTarget].imgheight);if(w>A){r.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight);r.lineTo(targets[curTarget].imgwidth,0);r.closePath()}else{r.lineTo(0,targets[curTarget].imgheight);r.lineTo(0,0);r.closePath()}}else{var b=k*(w-A)+c;var I=ineqlines[curTarget][v][0][1]-k*ineqlines[curTarget][v][0][0];var z=ineqlines[curTarget][v][0][1]+k*(targets[curTarget].imgwidth-ineqlines[curTarget][v][0][0]);r.moveTo(0,I);r.lineTo(targets[curTarget].imgwidth,z);if(a>b){r.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight);r.lineTo(0,targets[curTarget].imgheight);r.closePath()}else{r.lineTo(targets[curTarget].imgwidth,0);r.lineTo(0,0);r.closePath()}}r.fill();r.restore()}r.beginPath();if(A!=null){if(A!=ineqlines[curTarget][v][0][0]){var k=(c-ineqlines[curTarget][v][0][1])/(A-ineqlines[curTarget][v][0][0])}if(Math.abs(A-ineqlines[curTarget][v][0][0])<1||Math.abs(k)>100){if(ineqtypes[curTarget][v]==10.2){var m=targets[curTarget].imgheight/20;for(var u=0;u<10;u++){r.moveTo(ineqlines[curTarget][v][0][0],m*2*u);r.lineTo(ineqlines[curTarget][v][0][0],m*(2*u+1));r.stroke()}}else{r.moveTo(ineqlines[curTarget][v][0][0],0);r.lineTo(ineqlines[curTarget][v][0][0],targets[curTarget].imgheight);r.stroke()}}else{var I=ineqlines[curTarget][v][0][1]-k*ineqlines[curTarget][v][0][0];var z=ineqlines[curTarget][v][0][1]+k*(targets[curTarget].imgwidth-ineqlines[curTarget][v][0][0]);if(ineqtypes[curTarget][v]==10.2){var o=targets[curTarget].imgwidth/20;if(Math.abs(k)>1){o=o/Math.abs(k);if(o<1){o=1}}var q=Math.ceil(targets[curTarget].imgwidth/o);for(var u=0;u<q;u++){r.moveTo(o*2*u,I+k*o*2*u);r.lineTo(o*(2*u+1),I+k*o*(2*u+1));r.stroke()}}else{r.moveTo(0,I);r.lineTo(targets[curTarget].imgwidth,z);r.stroke()}}}r.beginPath();for(var u=0;u<ineqlines[curTarget][v].length;u++){if(u==2){r.arc(ineqlines[curTarget][v][u][0],ineqlines[curTarget][v][u][1],4,0,Math.PI*2,true);r.fill()}else{r.fillRect(ineqlines[curTarget][v][u][0]-3,ineqlines[curTarget][v][u][1]-3,6,6)}}r.beginPath()}r.fillStyle="rgb(0,0,255)";if(drawlocky[curTarget]==1){r.lineWidth=4}else{r.lineWidth=2}r.strokeStyle="rgb(0,0,255)";for(var v=0;v<tplines[curTarget].length;v++){if(tptypes[curTarget][v]>=5&&tptypes[curTarget][v]<6){var k=null;var A=null;var c=null;if(tplines[curTarget][v].length==2){A=tplines[curTarget][v][1][0];c=tplines[curTarget][v][1][1]}else{if(curTPcurve==v&&l!=null&&tplines[curTarget][v].length==1){A=l;c=h}}if(A!=null){if(tptypes[curTarget][v]==5.3){r.moveTo(tplines[curTarget][v][0][0],tplines[curTarget][v][0][1]);r.lineTo(A,c)}else{if(A!=tplines[curTarget][v][0][0]){var k=(c-tplines[curTarget][v][0][1])/(A-tplines[curTarget][v][0][0])}if(Math.abs(A-tplines[curTarget][v][0][0])<1||Math.abs(k)>100){if(tptypes[curTarget][v]==5.2){r.moveTo(tplines[curTarget][v][0][0],tplines[curTarget][v][0][1]);if(c>tplines[curTarget][v][0][1]){r.lineTo(tplines[curTarget][v][0][0],targets[curTarget].imgheight)}else{r.lineTo(tplines[curTarget][v][0][0],0)}}else{r.moveTo(tplines[curTarget][v][0][0],0);r.lineTo(tplines[curTarget][v][0][0],targets[curTarget].imgheight)}}else{var I=tplines[curTarget][v][0][1]-k*tplines[curTarget][v][0][0];var z=tplines[curTarget][v][0][1]+k*(targets[curTarget].imgwidth-tplines[curTarget][v][0][0]);var I=tplines[curTarget][v][0][1]-k*tplines[curTarget][v][0][0];var z=tplines[curTarget][v][0][1]+k*(targets[curTarget].imgwidth-tplines[curTarget][v][0][0]);if(tptypes[curTarget][v]==5.2){r.moveTo(tplines[curTarget][v][0][0],tplines[curTarget][v][0][1]);if(A>tplines[curTarget][v][0][0]){r.lineTo(targets[curTarget].imgwidth,z)}else{r.lineTo(0,I)}}else{r.moveTo(0,I);r.lineTo(targets[curTarget].imgwidth,z)}}}}}else{if(tptypes[curTarget][v]==6){var c=null;var A=null;if(tplines[curTarget][v].length==2){A=tplines[curTarget][v][1][0];c=tplines[curTarget][v][1][1]}else{if(curTPcurve==v&&l!=null&&tplines[curTarget][v].length==1){A=l;c=h}}if(A!=null&&A!=tplines[curTarget][v][0][0]){if(c==tplines[curTarget][v][0][1]){r.moveTo(0,c);r.lineTo(targets[curTarget].imgwidth,c)}else{var E=(c-tplines[curTarget][v][0][1])/((A-tplines[curTarget][v][0][0])*(A-tplines[curTarget][v][0][0]));if(c>tplines[curTarget][v][0][1]){var L=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][v][0][1])/E)+tplines[curTarget][v][0][0];var K=-1*Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][v][0][1])/E)+tplines[curTarget][v][0][0];var p=tplines[curTarget][v][0][1]-(targets[curTarget].imgheight-tplines[curTarget][v][0][1]);var J=targets[curTarget].imgheight}else{var L=Math.sqrt((0-tplines[curTarget][v][0][1])/E)+tplines[curTarget][v][0][0];var K=-1*Math.sqrt((0-tplines[curTarget][v][0][1])/E)+tplines[curTarget][v][0][0];var p=2*tplines[curTarget][v][0][1];var J=0}var C=L+2/3*(tplines[curTarget][v][0][0]-L);var B=J+2/3*(p-J);var f=C+(K-L)/3;var d=B;r.moveTo(L,J);r.bezierCurveTo(C,B,f,d,K,J)}}}else{if(tptypes[curTarget][v]==7){if(tplines[curTarget][v].length==2){A=tplines[curTarget][v][1][0];c=tplines[curTarget][v][1][1]}else{if(curTPcurve==v&&l!=null&&tplines[curTarget][v].length==1){A=l;c=h}}if(A!=null&&(A!=tplines[curTarget][v][0][0]||c!=tplines[curTarget][v][0][1])){var M=Math.sqrt((A-tplines[curTarget][v][0][0])*(A-tplines[curTarget][v][0][0])+(c-tplines[curTarget][v][0][1])*(c-tplines[curTarget][v][0][1]));r.arc(tplines[curTarget][v][0][0],tplines[curTarget][v][0][1],M,0,2*Math.PI,true)}}}}r.stroke();for(var u=0;u<tplines[curTarget][v].length;u++){r.fillRect(tplines[curTarget][v][u][0]-3,tplines[curTarget][v][u][1]-3,6,6)}r.beginPath()}var H,D,t,s;for(var v=0;v<lines[curTarget].length;v++){for(var u=0;u<lines[curTarget][v].length;u++){if(u==0){r.moveTo(lines[curTarget][v][u][0],lines[curTarget][v][u][1]);H=lines[curTarget][v][u][0];D=lines[curTarget][v][u][1]}else{r.lineTo(lines[curTarget][v][u][0],lines[curTarget][v][u][1]);t=lines[curTarget][v][u][0];s=lines[curTarget][v][u][1]}}if(v==curLine&&l!=null){r.lineTo(l,h);t=l;s=h}var g=targets[curTarget].imgwidth*0.02;if(drawlocky[curTarget]==1&&t>targets[curTarget].imgwidth*0.98){r.moveTo(t,s);r.lineTo(t-g,s+g);r.moveTo(t,s);r.lineTo(t-g,s-g)}else{if(drawlocky[curTarget]==1&&H>targets[curTarget].imgwidth*0.98){r.moveTo(H,D);r.lineTo(H-g,D+g);r.moveTo(H,D);r.lineTo(H-g,D-g)}}if(drawlocky[curTarget]==1&&t<targets[curTarget].imgwidth*0.02){r.moveTo(t,s);r.lineTo(t+g,s+g);r.moveTo(t,s);r.lineTo(t+g,s-g)}else{if(drawlocky[curTarget]==1&&H<targets[curTarget].imgwidth*0.02){r.moveTo(H,D);r.lineTo(H+g,D+g);r.moveTo(H,D);r.lineTo(H+g,D-g)}}}r.stroke();r.beginPath();for(var v=0;v<dots[curTarget].length;v++){r.moveTo(dots[curTarget][v][0]+5,dots[curTarget][v][1]);r.arc(dots[curTarget][v][0],dots[curTarget][v][1],5,0,Math.PI*2,true)}r.fill();if(targets[curTarget].dotline==true){r.beginPath();for(var v=0;v<lines[curTarget].length;v++){for(var u=0;u<lines[curTarget][v].length;u++){if((u==0)||Math.pow((lines[curTarget][v][u][0]-lines[curTarget][v][0][0]),2)+Math.pow((lines[curTarget][v][u][1]-lines[curTarget][v][0][1]),2)>25){r.moveTo(lines[curTarget][v][u][0]+5,lines[curTarget][v][u][1]);r.arc(lines[curTarget][v][u][0],lines[curTarget][v][u][1],5,0,Math.PI*2,true)}}}r.fill()}r.fillStyle="rgb(255,255,255)";r.beginPath();for(var v=0;v<odots[curTarget].length;v++){r.moveTo(odots[curTarget][v][0]+5,odots[curTarget][v][1]);r.arc(odots[curTarget][v][0],odots[curTarget][v][1],4,0,Math.PI*2,true)}r.fill();r.lineWidth=2;r.beginPath();for(var v=0;v<odots[curTarget].length;v++){r.moveTo(odots[curTarget][v][0]+5,odots[curTarget][v][1]);r.arc(odots[curTarget][v][0],odots[curTarget][v][1],4,0,Math.PI*2,true)}r.stroke();encodeDraw()}function encodeDraw(){var b="";for(var c=0;c<lines[curTarget].length;c++){if(c!=0){b+=";"}for(var a=0;a<lines[curTarget][c].length;a++){if(a!=0){b+=","}b+="("+lines[curTarget][c][a][0]+","+lines[curTarget][c][a][1]+")"}}b+=";;";for(var c=0;c<dots[curTarget].length;c++){if(c!=0){b+=","}b+="("+dots[curTarget][c][0]+","+dots[curTarget][c][1]+")"}b+=";;";for(var c=0;c<odots[curTarget].length;c++){if(c!=0){b+=","}b+="("+odots[curTarget][c][0]+","+odots[curTarget][c][1]+")"}b+=";;";for(var c=0;c<tplines[curTarget].length;c++){if(c!=0){b+=","}if(tplines[curTarget][c].length>1){b+="("+tptypes[curTarget][c]+","+tplines[curTarget][c][0][0]+","+tplines[curTarget][c][0][1]+","+tplines[curTarget][c][1][0]+","+tplines[curTarget][c][1][1]+")"}}b+=";;";for(var c=0;c<ineqlines[curTarget].length;c++){if(c!=0){b+=","}if(ineqlines[curTarget][c].length>2){b+="("+ineqtypes[curTarget][c]+","+ineqlines[curTarget][c][0][0]+","+ineqlines[curTarget][c][0][1]+","+ineqlines[curTarget][c][1][0]+","+ineqlines[curTarget][c][1][1]+","+ineqlines[curTarget][c][2][0]+","+ineqlines[curTarget][c][2][1]+")"}}targetOuts[curTarget].value=b}function drawMouseDown(d){var a=mouseCoords(d);if(curTarget==null){for(i in targets){var b=getPosition(targets[i].el);if(b.x<a.x&&(b.x+targets[i].width>a.x)&&b.y<a.y&&(b.y+targets[i].height>a.y)){curTarget=i;break}}}if(curTarget!=null){mouseisdown=true;var b=getPosition(targets[curTarget].el);var e={x:(a.x-b.x),y:(a.y-b.y)};if(e.x>-1&&e.x<targets[curTarget].width&&e.y>-1&&e.y<targets[curTarget].height){if(drawlocky[curTarget]==1){e.y=targets[curTarget].imgheight/2}var c=findnearpoint(curTarget,e);if(c==null){targets[curTarget].el.style.cursor="url("+imasroot+"/img/pendown.cur), default";if(targets[curTarget].mode==1){dots[curTarget].push([e.x,e.y]);dragObj={mode:1,num:dots[curTarget].length-1}}else{if(targets[curTarget].mode==2){odots[curTarget].push([e.x,e.y]);dragObj={mode:2,num:odots[curTarget].length-1}}else{if(targets[curTarget].mode==0){if(curLine==null){lines[curTarget].push([[e.x,e.y]]);curLine=lines[curTarget].length-1}else{lines[curTarget][curLine].push([e.x,e.y])}}else{if(targets[curTarget].mode==0.5){if(curLine==null){lines[curTarget].push([[e.x,e.y]]);curLine=lines[curTarget].length-1}else{lines[curTarget][curLine].push([e.x,e.y]);curLine=null;dragObj=null}}else{if(targets[curTarget].mode>=5&&targets[curTarget].mode<10){if(curTPcurve==null){tplines[curTarget].push([[e.x,e.y]]);curTPcurve=tplines[curTarget].length-1;tptypes[curTarget][curTPcurve]=targets[curTarget].mode;mouseisdown=false}else{tplines[curTarget][curTPcurve].push([e.x,e.y]);if(tplines[curTarget][curTPcurve].length==2){dragObj={mode:targets[curTarget].mode,num:curTPcurve,subnum:1};curTPcurve=null}}}else{if(targets[curTarget].mode>=10&&targets[curTarget].mode<11){if(curIneqcurve==null){ineqlines[curTarget].push([[e.x,e.y]]);curIneqcurve=ineqlines[curTarget].length-1;ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode;mouseisdown=false}else{ineqlines[curTarget][curIneqcurve].push([e.x,e.y]);if(ineqlines[curTarget][curIneqcurve].length==3){dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:1};curIneqcurve=null}}}}}}}}}else{if(c[0]==0||c[0]==0.5){if(curLine==null){targets[curTarget].el.style.cursor="move";dragObj={mode:targets[curTarget].mode,num:c[1],subnum:c[2]};oldpointpos=lines[curTarget][c[1]][c[2]];if(c[2]==lines[curTarget][c[1]].length-1&&targets[curTarget].mode==0){curLine=c[1]}else{if(c[2]==0&&targets[curTarget].mode==0){curLine=c[1];lines[curTarget][curLine].reverse();dragObj.subnum=lines[curTarget][curLine].length-1}}}else{if(c[1]==curLine&&c[2]==lines[curTarget][c[1]].length-1){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}curLine=null}else{targets[curTarget].el.style.cursor="url("+imasroot+"/img/pendown.cur), default";lines[curTarget][curLine].push([e.x,e.y])}}}else{if(c[0]==1){targets[curTarget].el.style.cursor="move";dragObj={mode:1,num:c[1]}}else{if(c[0]==2){targets[curTarget].el.style.cursor="move";dragObj={mode:2,num:c[1]}}else{if(c[0]>=5&&c[0]<10){targets[curTarget].el.style.cursor="move";dragObj={mode:c[0],num:c[1],subnum:c[2]};oldpointpos=tplines[curTarget][c[1]][c[2]]}else{if(c[0]>=10&&c[0]<11){targets[curTarget].el.style.cursor="move";dragObj={mode:c[0],num:c[1],subnum:c[2]};oldpointpos=ineqlines[curTarget][c[1]][c[2]]}}}}}}drawTarget()}else{if(curLine!=null){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}if(curTPcurve!=null){if(tplines[curTarget][curTPcurve].length<2){tplines[curTarget].splice(curTPcurve,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}if(curIneqcurve!=null){if(ineqlines[curTarget][curIneqcurve].length<3){ineqlines[curTarget].splice(curIneqcurve,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}curLine=null;curTPcurve=null;curIneqcurve=null;dragObj=null;drawTarget();curTarget=null}}}function findnearpoint(a,e){if(drawstyle[a]==0){if(targets[a].mode==0||targets[a].mode==0.5){for(var c=0;c<lines[a].length;c++){for(var b=lines[a][c].length-1;b>=0;b--){var d=Math.pow(lines[a][c][b][0]-e.x,2)+Math.pow(lines[a][c][b][1]-e.y,2);if(d<25){return[targets[a].mode,c,b]}}}}else{if(targets[a].mode==1){for(var c=0;c<dots[a].length;c++){if(Math.pow(dots[a][c][0]-e.x,2)+Math.pow(dots[a][c][1]-e.y,2)<25){return[1,c]}}}else{if(targets[a].mode==2){for(var c=0;c<odots[a].length;c++){if(Math.pow(odots[a][c][0]-e.x,2)+Math.pow(odots[a][c][1]-e.y,2)<25){return[2,c]}}}else{if(targets[a].mode>=5&&targets[a].mode<10){for(var c=0;c<tplines[a].length;c++){for(var b=tplines[a][c].length-1;b>=0;b--){var d=Math.pow(tplines[a][c][b][0]-e.x,2)+Math.pow(tplines[a][c][b][1]-e.y,2);if(d<25){return[tptypes[a][c],c,b]}}}}else{if(targets[a].mode>=10&&targets[a].mode<11){for(var c=0;c<ineqlines[a].length;c++){for(var b=ineqlines[a][c].length-1;b>=0;b--){var d=Math.pow(ineqlines[a][c][b][0]-e.x,2)+Math.pow(ineqlines[a][c][b][1]-e.y,2);if(d<25){return[ineqtypes[a][c],c,b]}}}}}}}}}else{for(var c=0;c<dots[a].length;c++){if(Math.pow(dots[a][c][0]-e.x,2)+Math.pow(dots[a][c][1]-e.y,2)<25){return[1,c]}}for(var c=0;c<odots[a].length;c++){if(Math.pow(odots[a][c][0]-e.x,2)+Math.pow(odots[a][c][1]-e.y,2)<25){return[2,c]}}for(var c=0;c<tplines[a].length;c++){for(var b=tplines[a][c].length-1;b>=0;b--){var d=Math.pow(tplines[a][c][b][0]-e.x,2)+Math.pow(tplines[a][c][b][1]-e.y,2);if(d<25){return[tptypes[a][c],c,b]}}}for(var c=0;c<ineqlines[a].length;c++){for(var b=ineqlines[a][c].length-1;b>=0;b--){var d=Math.pow(ineqlines[a][c][b][0]-e.x,2)+Math.pow(ineqlines[a][c][b][1]-e.y,2);if(d<25){return[ineqtypes[a][c],c,b]}}}}return null}var lastdrawmouseup=null;function drawMouseUp(c){var a=mouseCoords(c);mouseisdown=false;if(curTarget!=null){if(lastdrawmouseup!=null&&a.x==lastdrawmouseup.x&&a.y==lastdrawmouseup.y){if(curLine!=null&&dragObj==null){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}curLine=null;dragObj=null;drawTarget()}}if(curLine!=null&&dragObj==null){if(targets[curTarget].mode==0.5&&lines[curTarget][curLine].length>1){curLine=null;dragobj=null;drawTarget()}}if(curLine==null&&curTPcurve==null){targets[curTarget].el.style.cursor="move"}else{targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}}lastdrawmouseup=a;if(curTarget!=null&&dragObj!=null){var b=getPosition(targets[curTarget].el);var d={x:(a.x-b.x),y:(a.y-b.y)};if(d.x>-1&&d.x<targets[curTarget].width&&d.y>-1&&d.y<targets[curTarget].height){dragObj=null}else{if(drawlocky[curTarget]==1){d.y=targets[curTarget].imgheight/2}if(dragObj.mode==1){dots[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==2){odots[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==0.5){lines[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==0){lines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos}else{if(dragObj.mode>=5&&dragObj.mode<10){tplines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos;curTPcurve=null}else{if(dragObj.mode>=10&&dragObj.mode<11){ineqlines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos;curIneqcurve=null}}}}}}dragObj=null;drawTarget()}}}function drawMouseMove(f){var b=null;var a=mouseCoords(f);if(curTarget==null){for(i in targets){var c=getPosition(targets[i].el);if(c.x<a.x&&(c.x+targets[i].width>a.x)&&c.y<a.y&&(c.y+targets[i].height>a.y)){b=i;break}}}if(b!=null){var c=getPosition(targets[b].el);var h={x:(a.x-c.x),y:(a.y-c.y)};if(drawlocky[b]==1){h.y=targets[b].imgheight/2}if(h.x>-1&&h.x<targets[b].width&&h.y>-1&&h.y<targets[b].height){if(dragObj==null){if(curLine==null){var d=findnearpoint(b,h);if(d==null){targets[b].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}else{targets[b].el.style.cursor="move"}}}}}if(curTarget!=null){var c=getPosition(targets[curTarget].el);var h={x:(a.x-c.x),y:(a.y-c.y)};if(drawlocky[curTarget]==1){h.y=targets[curTarget].imgheight/2}if(h.x>-1&&h.x<targets[curTarget].width&&h.y>-1&&h.y<targets[curTarget].height){if(dragObj==null){if(curLine!=null){if(mouseisdown&&targets[curTarget].mode==0){var e=lines[curTarget][curLine].length-1;var g=Math.pow(lines[curTarget][curLine][e][0]-h.x,2)+Math.pow(lines[curTarget][curLine][e][1]-h.y,2);if(g>25){lines[curTarget][curLine].push([h.x,h.y]);drawTarget()}else{drawTarget(h.x,h.y)}}else{if(mouseisdown&&targets[curTarget].mode==0.5){var e=lines[curTarget][curLine].length-1;if(e==0){var g=Math.pow(lines[curTarget][curLine][e][0]-h.x,2)+Math.pow(lines[curTarget][curLine][e][1]-h.y,2);if(g>25){lines[curTarget][curLine].push([h.x,h.y]);drawTarget()}else{drawTarget(h.x,h.y)}}else{lines[curTarget][curLine][e]=[h.x,h.y];drawTarget()}}else{drawTarget(h.x,h.y)}}}else{if(curTPcurve!=null){if(mouseisdown){drawTarget()}else{drawTarget(h.x,h.y)}}else{if(curIneqcurve!=null){if(mouseisdown){drawTarget()}else{drawTarget(h.x,h.y)}}else{var d=findnearpoint(curTarget,h);if(d==null){targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}else{targets[curTarget].el.style.cursor="move"}}}}}else{targets[curTarget].el.style.cursor="move";if(dragObj.mode==0||dragObj.mode==0.5){lines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}else{if(dragObj.mode==1){dots[curTarget][dragObj.num]=[h.x,h.y]}else{if(dragObj.mode==2){odots[curTarget][dragObj.num]=[h.x,h.y]}else{if(dragObj.mode>=5&&dragObj.mode<10){tplines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}else{if(dragObj.mode>=10&&dragObj.mode<11){ineqlines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}}}}}drawTarget()}return false}}}function mouseCoords(e){e=e||window.event;if(e.pageX||e.pageY){return{x:e.pageX,y:e.pageY}}var a=document.documentElement,c=document.body;if(a&&(a.scrollTop||a.scrollLeft)){var b=a.scrollLeft;var d=a.scrollTop}else{if(c){var b=c.scrollLeft;var d=c.scrollTop}else{var b=0;var d=0}}return{x:e.clientX+b,y:e.clientY+d}}function getMouseOffset(d,c){var b=getPosition(d);var a=mouseCoords(c);return{x:a.x-b.x,y:a.y-b.y}}function getPosition(f){var d=0;var c=0;if(f.getBoundingClientRect){var a=f.getBoundingClientRect();var b=Math.max(document.documentElement.scrollTop,document.body.scrollTop);var g=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);return{x:a.left+g,y:a.top+b}}while(f.offsetParent){d+=f.offsetLeft;c+=f.offsetTop;f=f.offsetParent}d+=f.offsetLeft;c+=f.offsetTop;return{x:d,y:c}}function initCanvases(){for(var b=0;b<canvases.length;b++){if(drawla[b]!=null&&drawla[b].length>2){lines[canvases[b][0]]=drawla[b][0];dots[canvases[b][0]]=drawla[b][1];odots[canvases[b][0]]=drawla[b][2];if(drawla[b].length>3&&drawla[b][3].length>0){tptypes[canvases[b][0]]=[];tplines[canvases[b][0]]=[];for(var a=0;a<drawla[b][3].length;a++){tptypes[canvases[b][0]][a]=drawla[b][3][a][0];tplines[canvases[b][0]][a]=[drawla[b][3][a].slice(1,3),drawla[b][3][a].slice(3)]}}if(drawla[b].length>4&&drawla[b][4].length>0){ineqtypes[canvases[b][0]]=[];ineqlines[canvases[b][0]]=[];for(var a=0;a<drawla[b][4].length;a++){ineqtypes[canvases[b][0]][a]=drawla[b][4][a][0];ineqlines[canvases[b][0]][a]=[drawla[b][4][a].slice(1,3),drawla[b][4][a].slice(3,5),drawla[b][4][a].slice(5)]}}}addTarget(canvases[b][0],"canvas"+canvases[b][0],imasroot+"/filter/graph/imgs/"+canvases[b][1],"qn"+canvases[b][0],canvases[b][2],canvases[b][3],canvases[b][4],canvases[b][5],canvases[b][6],canvases[b][7],canvases[b][8],canvases[b][9],canvases[b][10],canvases[b][11])}}document.onmousedown=drawMouseDown;document.onmouseup=drawMouseUp;document.onmousemove=drawMouseMove;if(typeof(initstack)!="undefined"){initstack.push(initCanvases)}else{if(typeof window.addEventListener!="undefined"){window.addEventListener("load",initCanvases,false)}else{if(typeof document.addEventListener!="undefined"){document.addEventListener("load",initCanvases,false)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onload",initCanvases)}else{if(typeof window.onload=="function"){var existing=onload;window.onload=function(){existing();initCanvases()}}else{window.onload=initCanvases}}}}};