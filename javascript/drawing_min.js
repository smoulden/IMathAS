var mouseisdown=false;var targets=new Array();var imgs=new Array();var targetOuts=new Array();var lines=new Array();var dots=new Array();var odots=new Array();var tplines=new Array();var tptypes=new Array();var ineqlines=new Array();var ineqtypes=new Array();var canvases=new Array();var drawla=new Array();var curLine=null;var drawstyle=[];var curTPcurve=null;var curIneqcurve=null;var ineqcolors=["rgb(0,0,255)","rgb(255,0,0)","rgb(0,255,0)"];var ineqacolors=["rgba(0,0,255,.4)","rgba(255,0,0,.4)","rgba(0,255,0,.4)"];var dragObj=null;var oldpointpos=null;var curTarget=null;var nocanvaswarning=false;function clearcanvas(a){lines[a].length=0;dots[a].length=0;odots[a].length=0;tplines[a].length=0;tptypes[a].length=0;ineqlines[a].length=0;ineqtypes[a].length=0;curTarget=a;drawTarget();curTarget=null;curLine=null;dragObj=null}function addTarget(o,j,f,l,a,g,n,e,d,p,k,m,c){var h=document.getElementById(j);var b=getPosition(h);targets[o]={el:h,left:b.x,top:b.y,width:h.offsetWidth,height:h.offsetHeight,xmin:a,xmax:g,ymin:n,ymax:e,imgborder:d,imgwidth:p,imgheight:k,mode:m,dotline:c};targetOuts[o]=document.getElementById(l);if(lines[o]==null){lines[o]=new Array()}if(dots[o]==null){dots[o]=new Array()}if(odots[o]==null){odots[o]=new Array()}if(tplines[o]==null){tplines[o]=new Array()}if(tptypes[o]==null){tptypes[o]=new Array()}if(ineqlines[o]==null){ineqlines[o]=new Array()}if(ineqtypes[o]==null){ineqtypes[o]=new Array()}if(m>=5){drawstyle[o]=1}else{drawstyle[o]=0}imgs[o]=new Image();imgs[o].onload=function(){var q=curTarget;curTarget=o;drawTarget();curTarget=q};imgs[o].src=f}function settool(a,d,e){var c=document.getElementById("drawtools"+d);var f=c.getElementsByTagName("span");for(var b=0;b<f.length;b++){f[b].className=""}f=c.getElementsByTagName("img");for(var b=0;b<f.length;b++){f[b].className=""}a.className="sel";setDrawMode(d,e)}function setDrawMode(a,b){targets[a].mode=b}function setDotLine(b,a){targets[b].dotline=a}function drawTarget(k,g){try{var q=targets[curTarget].el.getContext("2d")}catch(C){if(!nocanvaswarning){nocanvaswarning=true;alert("Your browser does not support drawing answer entry.  Please try again using Internet Explorer 6+ (Windows), FireFox 1.5+ (Win/Mac), Safari 1.3+ (Mac), Opera 9+ (Win/Mac), or Camino (Mac)")}}q.fillStyle="rgb(0,0,255)";q.lineWidth=2;q.strokeStyle="rgb(0,0,255)";q.clearRect(0,0,targets[curTarget].imgwidth,targets[curTarget].imgheight);q.drawImage(imgs[curTarget],0,0);q.beginPath();for(var s=0;s<ineqlines[curTarget].length;s++){var B=s%3;q.strokeStyle=ineqcolors[B];q.fillStyle=ineqcolors[B];var h=null;var v=null;var t=null;var c=null;var a=null;if(ineqlines[curTarget][s].length==3){v=ineqlines[curTarget][s][1][0];c=ineqlines[curTarget][s][1][1];t=ineqlines[curTarget][s][2][0];a=ineqlines[curTarget][s][2][1]}else{if(ineqlines[curTarget][s].length==2){v=ineqlines[curTarget][s][1][0];c=ineqlines[curTarget][s][1][1];t=k;a=g}else{if(curIneqcurve==s&&k!=null&&ineqlines[curTarget][s].length==1){v=k;c=g}}}if(t!=null){q.save();q.fillStyle=ineqacolors[B];q.beginPath();if(v!=ineqlines[curTarget][s][0][0]){var h=(c-ineqlines[curTarget][s][0][1])/(v-ineqlines[curTarget][s][0][0])}if(Math.abs(v-ineqlines[curTarget][s][0][0])<1||Math.abs(h)>100){q.moveTo(ineqlines[curTarget][s][0][0],0);q.lineTo(ineqlines[curTarget][s][0][0],targets[curTarget].imgheight);if(t>v){q.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight);q.lineTo(targets[curTarget].imgwidth,0);q.closePath()}else{q.lineTo(0,targets[curTarget].imgheight);q.lineTo(0,0);q.closePath()}}else{var b=h*(t-v)+c;var D=ineqlines[curTarget][s][0][1]-h*ineqlines[curTarget][s][0][0];var u=ineqlines[curTarget][s][0][1]+h*(targets[curTarget].imgwidth-ineqlines[curTarget][s][0][0]);q.moveTo(0,D);q.lineTo(targets[curTarget].imgwidth,u);if(a>b){q.lineTo(targets[curTarget].imgwidth,targets[curTarget].imgheight);q.lineTo(0,targets[curTarget].imgheight);q.closePath()}else{q.lineTo(targets[curTarget].imgwidth,0);q.lineTo(0,0);q.closePath()}}q.fill();q.restore()}q.beginPath();if(v!=null){if(v!=ineqlines[curTarget][s][0][0]){var h=(c-ineqlines[curTarget][s][0][1])/(v-ineqlines[curTarget][s][0][0])}if(Math.abs(v-ineqlines[curTarget][s][0][0])<1||Math.abs(h)>100){if(ineqtypes[curTarget][s]==10.2){var l=targets[curTarget].imgheight/20;for(var r=0;r<10;r++){q.moveTo(ineqlines[curTarget][s][0][0],l*2*r);q.lineTo(ineqlines[curTarget][s][0][0],l*(2*r+1));q.stroke()}}else{q.moveTo(ineqlines[curTarget][s][0][0],0);q.lineTo(ineqlines[curTarget][s][0][0],targets[curTarget].imgheight);q.stroke()}}else{var D=ineqlines[curTarget][s][0][1]-h*ineqlines[curTarget][s][0][0];var u=ineqlines[curTarget][s][0][1]+h*(targets[curTarget].imgwidth-ineqlines[curTarget][s][0][0]);if(ineqtypes[curTarget][s]==10.2){var m=targets[curTarget].imgwidth/20;if(Math.abs(h)>1){m=m/Math.abs(h);if(m<1){m=1}}var p=Math.ceil(targets[curTarget].imgwidth/m);for(var r=0;r<p;r++){q.moveTo(m*2*r,D+h*m*2*r);q.lineTo(m*(2*r+1),D+h*m*(2*r+1));q.stroke()}}else{q.moveTo(0,D);q.lineTo(targets[curTarget].imgwidth,u);q.stroke()}}}q.beginPath();for(var r=0;r<ineqlines[curTarget][s].length;r++){if(r==2){q.arc(ineqlines[curTarget][s][r][0],ineqlines[curTarget][s][r][1],4,0,Math.PI*2,true);q.fill()}else{q.fillRect(ineqlines[curTarget][s][r][0]-3,ineqlines[curTarget][s][r][1]-3,6,6)}}q.beginPath()}q.fillStyle="rgb(0,0,255)";q.lineWidth=2;q.strokeStyle="rgb(0,0,255)";for(var s=0;s<tplines[curTarget].length;s++){if(tptypes[curTarget][s]>=5&&tptypes[curTarget][s]<6){var h=null;var v=null;var c=null;if(tplines[curTarget][s].length==2){v=tplines[curTarget][s][1][0];c=tplines[curTarget][s][1][1]}else{if(curTPcurve==s&&k!=null&&tplines[curTarget][s].length==1){v=k;c=g}}if(v!=null){if(tptypes[curTarget][s]==5.3){q.moveTo(tplines[curTarget][s][0][0],tplines[curTarget][s][0][1]);q.lineTo(v,c)}else{if(v!=tplines[curTarget][s][0][0]){var h=(c-tplines[curTarget][s][0][1])/(v-tplines[curTarget][s][0][0])}if(Math.abs(v-tplines[curTarget][s][0][0])<1||Math.abs(h)>100){if(tptypes[curTarget][s]==5.2){q.moveTo(tplines[curTarget][s][0][0],tplines[curTarget][s][0][1]);if(c>tplines[curTarget][s][0][1]){q.lineTo(tplines[curTarget][s][0][0],targets[curTarget].imgheight)}else{q.lineTo(tplines[curTarget][s][0][0],0)}}else{q.moveTo(tplines[curTarget][s][0][0],0);q.lineTo(tplines[curTarget][s][0][0],targets[curTarget].imgheight)}}else{var D=tplines[curTarget][s][0][1]-h*tplines[curTarget][s][0][0];var u=tplines[curTarget][s][0][1]+h*(targets[curTarget].imgwidth-tplines[curTarget][s][0][0]);var D=tplines[curTarget][s][0][1]-h*tplines[curTarget][s][0][0];var u=tplines[curTarget][s][0][1]+h*(targets[curTarget].imgwidth-tplines[curTarget][s][0][0]);if(tptypes[curTarget][s]==5.2){q.moveTo(tplines[curTarget][s][0][0],tplines[curTarget][s][0][1]);if(v>tplines[curTarget][s][0][0]){q.lineTo(targets[curTarget].imgwidth,u)}else{q.lineTo(0,D)}}else{q.moveTo(0,D);q.lineTo(targets[curTarget].imgwidth,u)}}}}}else{if(tptypes[curTarget][s]==6){var c=null;var v=null;if(tplines[curTarget][s].length==2){v=tplines[curTarget][s][1][0];c=tplines[curTarget][s][1][1]}else{if(curTPcurve==s&&k!=null&&tplines[curTarget][s].length==1){v=k;c=g}}if(v!=null&&v!=tplines[curTarget][s][0][0]){if(c==tplines[curTarget][s][0][1]){q.moveTo(0,c);q.lineTo(targets[curTarget].imgwidth,c)}else{var A=(c-tplines[curTarget][s][0][1])/((v-tplines[curTarget][s][0][0])*(v-tplines[curTarget][s][0][0]));if(c>tplines[curTarget][s][0][1]){var G=Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][s][0][1])/A)+tplines[curTarget][s][0][0];var F=-1*Math.sqrt((targets[curTarget].imgheight-tplines[curTarget][s][0][1])/A)+tplines[curTarget][s][0][0];var o=tplines[curTarget][s][0][1]-(targets[curTarget].imgheight-tplines[curTarget][s][0][1]);var E=targets[curTarget].imgheight}else{var G=Math.sqrt((0-tplines[curTarget][s][0][1])/A)+tplines[curTarget][s][0][0];var F=-1*Math.sqrt((0-tplines[curTarget][s][0][1])/A)+tplines[curTarget][s][0][0];var o=2*tplines[curTarget][s][0][1];var E=0}var z=G+2/3*(tplines[curTarget][s][0][0]-G);var w=E+2/3*(o-E);var f=z+(F-G)/3;var d=w;q.moveTo(G,E);q.bezierCurveTo(z,w,f,d,F,E)}}}else{if(tptypes[curTarget][s]==7){if(tplines[curTarget][s].length==2){v=tplines[curTarget][s][1][0];c=tplines[curTarget][s][1][1]}else{if(curTPcurve==s&&k!=null&&tplines[curTarget][s].length==1){v=k;c=g}}if(v!=null&&(v!=tplines[curTarget][s][0][0]||c!=tplines[curTarget][s][0][1])){var H=Math.sqrt((v-tplines[curTarget][s][0][0])*(v-tplines[curTarget][s][0][0])+(c-tplines[curTarget][s][0][1])*(c-tplines[curTarget][s][0][1]));q.arc(tplines[curTarget][s][0][0],tplines[curTarget][s][0][1],H,0,2*Math.PI,true)}}}}q.stroke();for(var r=0;r<tplines[curTarget][s].length;r++){q.fillRect(tplines[curTarget][s][r][0]-3,tplines[curTarget][s][r][1]-3,6,6)}q.beginPath()}for(var s=0;s<lines[curTarget].length;s++){for(var r=0;r<lines[curTarget][s].length;r++){if(r==0){q.moveTo(lines[curTarget][s][r][0],lines[curTarget][s][r][1])}else{q.lineTo(lines[curTarget][s][r][0],lines[curTarget][s][r][1])}}if(s==curLine&&k!=null){q.lineTo(k,g)}}for(var s=0;s<odots[curTarget].length;s++){q.moveTo(odots[curTarget][s][0]+5,odots[curTarget][s][1]);q.arc(odots[curTarget][s][0],odots[curTarget][s][1],4,0,Math.PI*2,true)}q.stroke();q.beginPath();for(var s=0;s<dots[curTarget].length;s++){q.moveTo(dots[curTarget][s][0]+5,dots[curTarget][s][1]);q.arc(dots[curTarget][s][0],dots[curTarget][s][1],5,0,Math.PI*2,true)}q.fill();if(targets[curTarget].dotline==true){q.beginPath();for(var s=0;s<lines[curTarget].length;s++){for(var r=0;r<lines[curTarget][s].length;r++){if((r==0)||Math.pow((lines[curTarget][s][r][0]-lines[curTarget][s][0][0]),2)+Math.pow((lines[curTarget][s][r][1]-lines[curTarget][s][0][1]),2)>25){q.moveTo(lines[curTarget][s][r][0]+5,lines[curTarget][s][r][1]);q.arc(lines[curTarget][s][r][0],lines[curTarget][s][r][1],5,0,Math.PI*2,true)}}}q.fill()}encodeDraw()}function encodeDraw(){var b="";for(var c=0;c<lines[curTarget].length;c++){if(c!=0){b+=";"}for(var a=0;a<lines[curTarget][c].length;a++){if(a!=0){b+=","}b+="("+lines[curTarget][c][a][0]+","+lines[curTarget][c][a][1]+")"}}b+=";;";for(var c=0;c<dots[curTarget].length;c++){if(c!=0){b+=","}b+="("+dots[curTarget][c][0]+","+dots[curTarget][c][1]+")"}b+=";;";for(var c=0;c<odots[curTarget].length;c++){if(c!=0){b+=","}b+="("+odots[curTarget][c][0]+","+odots[curTarget][c][1]+")"}b+=";;";for(var c=0;c<tplines[curTarget].length;c++){if(c!=0){b+=","}if(tplines[curTarget][c].length>1){b+="("+tptypes[curTarget][c]+","+tplines[curTarget][c][0][0]+","+tplines[curTarget][c][0][1]+","+tplines[curTarget][c][1][0]+","+tplines[curTarget][c][1][1]+")"}}b+=";;";for(var c=0;c<ineqlines[curTarget].length;c++){if(c!=0){b+=","}if(ineqlines[curTarget][c].length>2){b+="("+ineqtypes[curTarget][c]+","+ineqlines[curTarget][c][0][0]+","+ineqlines[curTarget][c][0][1]+","+ineqlines[curTarget][c][1][0]+","+ineqlines[curTarget][c][1][1]+","+ineqlines[curTarget][c][2][0]+","+ineqlines[curTarget][c][2][1]+")"}}targetOuts[curTarget].value=b}function drawMouseDown(d){var a=mouseCoords(d);if(curTarget==null){for(i in targets){var b=getPosition(targets[i].el);if(b.x<a.x&&(b.x+targets[i].width>a.x)&&b.y<a.y&&(b.y+targets[i].height>a.y)){curTarget=i;break}}}if(curTarget!=null){mouseisdown=true;var b=getPosition(targets[curTarget].el);var e={x:(a.x-b.x),y:(a.y-b.y)};if(e.x>-1&&e.x<targets[curTarget].width&&e.y>-1&&e.y<targets[curTarget].height){var c=findnearpoint(curTarget,e);if(c==null){targets[curTarget].el.style.cursor="url("+imasroot+"/img/pendown.cur), default";if(targets[curTarget].mode==1){dots[curTarget].push([e.x,e.y]);dragObj={mode:1,num:dots[curTarget].length-1}}else{if(targets[curTarget].mode==2){odots[curTarget].push([e.x,e.y]);dragObj={mode:2,num:odots[curTarget].length-1}}else{if(targets[curTarget].mode==0){if(curLine==null){lines[curTarget].push([[e.x,e.y]]);curLine=lines[curTarget].length-1}else{lines[curTarget][curLine].push([e.x,e.y])}}else{if(targets[curTarget].mode>=5&&targets[curTarget].mode<10){if(curTPcurve==null){tplines[curTarget].push([[e.x,e.y]]);curTPcurve=tplines[curTarget].length-1;tptypes[curTarget][curTPcurve]=targets[curTarget].mode;mouseisdown=false}else{tplines[curTarget][curTPcurve].push([e.x,e.y]);if(tplines[curTarget][curTPcurve].length==2){dragObj={mode:targets[curTarget].mode,num:curTPcurve,subnum:1};curTPcurve=null}}}else{if(targets[curTarget].mode>=10&&targets[curTarget].mode<11){if(curIneqcurve==null){ineqlines[curTarget].push([[e.x,e.y]]);curIneqcurve=ineqlines[curTarget].length-1;ineqtypes[curTarget][curIneqcurve]=targets[curTarget].mode;mouseisdown=false}else{ineqlines[curTarget][curIneqcurve].push([e.x,e.y]);if(ineqlines[curTarget][curIneqcurve].length==3){dragObj={mode:targets[curTarget].mode,num:curIneqcurve,subnum:1};curIneqcurve=null}}}}}}}}else{if(c[0]==0){if(curLine==null){targets[curTarget].el.style.cursor="move";dragObj={mode:0,num:c[1],subnum:c[2]};oldpointpos=lines[curTarget][c[1]][c[2]];if(c[2]==lines[curTarget][c[1]].length-1){curLine=c[1]}else{if(c[2]==0){curLine=c[1];lines[curTarget][curLine].reverse();dragObj.subnum=lines[curTarget][curLine].length-1}}}else{if(c[1]==curLine&&c[2]==lines[curTarget][c[1]].length-1){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}curLine=null}else{targets[curTarget].el.style.cursor="url("+imasroot+"/img/pendown.cur), default";lines[curTarget][curLine].push([e.x,e.y])}}}else{if(c[0]==1){targets[curTarget].el.style.cursor="move";dragObj={mode:1,num:c[1]}}else{if(c[0]==2){targets[curTarget].el.style.cursor="move";dragObj={mode:2,num:c[1]}}else{if(c[0]>=5&&c[0]<10){targets[curTarget].el.style.cursor="move";dragObj={mode:c[0],num:c[1],subnum:c[2]};oldpointpos=tplines[curTarget][c[1]][c[2]]}else{if(c[0]>=10&&c[0]<11){targets[curTarget].el.style.cursor="move";dragObj={mode:c[0],num:c[1],subnum:c[2]};oldpointpos=ineqlines[curTarget][c[1]][c[2]]}}}}}}drawTarget()}else{if(curLine!=null){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}if(curTPcurve!=null){if(tplines[curTarget][curTPcurve].length<2){tplines[curTarget].splice(curTPcurve,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}if(curIneqcurve!=null){if(ineqlines[curTarget][curIneqcurve].length<3){ineqlines[curTarget].splice(curIneqcurve,1)}targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}curLine=null;curTPcurve=null;curIneqcurve=null;dragObj=null;drawTarget();curTarget=null}}}function findnearpoint(a,e){if(drawstyle[a]==0){if(targets[a].mode==0){for(var c=0;c<lines[a].length;c++){for(var b=lines[a][c].length-1;b>=0;b--){var d=Math.pow(lines[a][c][b][0]-e.x,2)+Math.pow(lines[a][c][b][1]-e.y,2);if(d<25){return[0,c,b]}}}}else{if(targets[a].mode==1){for(var c=0;c<dots[a].length;c++){if(Math.pow(dots[a][c][0]-e.x,2)+Math.pow(dots[a][c][1]-e.y,2)<25){return[1,c]}}}else{if(targets[a].mode==2){for(var c=0;c<odots[a].length;c++){if(Math.pow(odots[a][c][0]-e.x,2)+Math.pow(odots[a][c][1]-e.y,2)<25){return[2,c]}}}else{if(targets[a].mode>=5&&targets[a].mode<10){for(var c=0;c<tplines[a].length;c++){for(var b=tplines[a][c].length-1;b>=0;b--){var d=Math.pow(tplines[a][c][b][0]-e.x,2)+Math.pow(tplines[a][c][b][1]-e.y,2);if(d<25){return[tptypes[a][c],c,b]}}}}else{if(targets[a].mode>=10&&targets[a].mode<11){for(var c=0;c<ineqlines[a].length;c++){for(var b=ineqlines[a][c].length-1;b>=0;b--){var d=Math.pow(ineqlines[a][c][b][0]-e.x,2)+Math.pow(ineqlines[a][c][b][1]-e.y,2);if(d<25){return[ineqtypes[a][c],c,b]}}}}}}}}}else{for(var c=0;c<dots[a].length;c++){if(Math.pow(dots[a][c][0]-e.x,2)+Math.pow(dots[a][c][1]-e.y,2)<25){return[1,c]}}for(var c=0;c<odots[a].length;c++){if(Math.pow(odots[a][c][0]-e.x,2)+Math.pow(odots[a][c][1]-e.y,2)<25){return[2,c]}}for(var c=0;c<tplines[a].length;c++){for(var b=tplines[a][c].length-1;b>=0;b--){var d=Math.pow(tplines[a][c][b][0]-e.x,2)+Math.pow(tplines[a][c][b][1]-e.y,2);if(d<25){return[tptypes[a][c],c,b]}}}for(var c=0;c<ineqlines[a].length;c++){for(var b=ineqlines[a][c].length-1;b>=0;b--){var d=Math.pow(ineqlines[a][c][b][0]-e.x,2)+Math.pow(ineqlines[a][c][b][1]-e.y,2);if(d<25){return[ineqtypes[a][c],c,b]}}}}return null}var lastdrawmouseup=null;function drawMouseUp(c){var a=mouseCoords(c);mouseisdown=false;if(curTarget!=null){if(lastdrawmouseup!=null&&a.x==lastdrawmouseup.x&&a.y==lastdrawmouseup.y){if(curLine!=null&&dragObj==null){if(lines[curTarget][curLine].length<2){lines[curTarget].splice(curLine,1)}curLine=null;dragObj=null;drawTarget()}}if(curLine==null&&curTPcurve==null){targets[curTarget].el.style.cursor="move"}else{targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}}lastdrawmouseup=a;if(curTarget!=null&&dragObj!=null){var b=getPosition(targets[curTarget].el);var d={x:(a.x-b.x),y:(a.y-b.y)};if(d.x>-1&&d.x<targets[curTarget].width&&d.y>-1&&d.y<targets[curTarget].height){dragObj=null}else{if(dragObj.mode==1){dots[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==2){odots[curTarget].splice(dragObj.num,1)}else{if(dragObj.mode==0){lines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos}else{if(dragObj.mode>=5&&dragObj.mode<10){tplines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos;curTPcurve=null}else{if(dragObj.mode>=10&&dragObj.mode<11){ineqlines[curTarget][dragObj.num][dragObj.subnum]=oldpointpos;curIneqcurve=null}}}}}dragObj=null;drawTarget()}}}function drawMouseMove(f){var b=null;var a=mouseCoords(f);if(curTarget==null){for(i in targets){var c=getPosition(targets[i].el);if(c.x<a.x&&(c.x+targets[i].width>a.x)&&c.y<a.y&&(c.y+targets[i].height>a.y)){b=i;break}}}if(b!=null){var c=getPosition(targets[b].el);var h={x:(a.x-c.x),y:(a.y-c.y)};if(h.x>-1&&h.x<targets[b].width&&h.y>-1&&h.y<targets[b].height){if(dragObj==null){if(curLine==null){var d=findnearpoint(b,h);if(d==null){targets[b].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}else{targets[b].el.style.cursor="move"}}}}}if(curTarget!=null){var c=getPosition(targets[curTarget].el);var h={x:(a.x-c.x),y:(a.y-c.y)};if(h.x>-1&&h.x<targets[curTarget].width&&h.y>-1&&h.y<targets[curTarget].height){if(dragObj==null){if(curLine!=null){if(mouseisdown){var e=lines[curTarget][curLine].length-1;var g=Math.pow(lines[curTarget][curLine][e][0]-h.x,2)+Math.pow(lines[curTarget][curLine][e][1]-h.y,2);if(g>25){lines[curTarget][curLine].push([h.x,h.y]);drawTarget()}else{drawTarget(h.x,h.y)}}else{drawTarget(h.x,h.y)}}else{if(curTPcurve!=null){if(mouseisdown){drawTarget()}else{drawTarget(h.x,h.y)}}else{if(curIneqcurve!=null){if(mouseisdown){drawTarget()}else{drawTarget(h.x,h.y)}}else{var d=findnearpoint(curTarget,h);if(d==null){targets[curTarget].el.style.cursor="url("+imasroot+"/img/pen.cur), default"}else{targets[curTarget].el.style.cursor="move"}}}}}else{targets[curTarget].el.style.cursor="move";if(dragObj.mode==0){lines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}else{if(dragObj.mode==1){dots[curTarget][dragObj.num]=[h.x,h.y]}else{if(dragObj.mode==2){odots[curTarget][dragObj.num]=[h.x,h.y]}else{if(dragObj.mode>=5&&dragObj.mode<10){tplines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}else{if(dragObj.mode>=10&&dragObj.mode<11){ineqlines[curTarget][dragObj.num][dragObj.subnum]=[h.x,h.y]}}}}}drawTarget()}return false}}}function mouseCoords(e){e=e||window.event;if(e.pageX||e.pageY){return{x:e.pageX,y:e.pageY}}var a=document.documentElement,c=document.body;if(a&&(a.scrollTop||a.scrollLeft)){var b=a.scrollLeft;var d=a.scrollTop}else{if(c){var b=c.scrollLeft;var d=c.scrollTop}else{var b=0;var d=0}}return{x:e.clientX+b,y:e.clientY+d}}function getMouseOffset(d,c){var b=getPosition(d);var a=mouseCoords(c);return{x:a.x-b.x,y:a.y-b.y}}function getPosition(f){var d=0;var c=0;if(f.getBoundingClientRect){var a=f.getBoundingClientRect();var b=Math.max(document.documentElement.scrollTop,document.body.scrollTop);var g=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);return{x:a.left+g,y:a.top+b}}while(f.offsetParent){d+=f.offsetLeft;c+=f.offsetTop;f=f.offsetParent}d+=f.offsetLeft;c+=f.offsetTop;return{x:d,y:c}}function initCanvases(){for(var b=0;b<canvases.length;b++){if(drawla[b]!=null&&drawla[b].length>2){lines[canvases[b][0]]=drawla[b][0];dots[canvases[b][0]]=drawla[b][1];odots[canvases[b][0]]=drawla[b][2];if(drawla[b].length>3&&drawla[b][3].length>0){tptypes[canvases[b][0]]=[];tplines[canvases[b][0]]=[];for(var a=0;a<drawla[b][3].length;a++){tptypes[canvases[b][0]][a]=drawla[b][3][a][0];tplines[canvases[b][0]][a]=[drawla[b][3][a].slice(1,3),drawla[b][3][a].slice(3)]}}if(drawla[b].length>4&&drawla[b][4].length>0){ineqtypes[canvases[b][0]]=[];ineqlines[canvases[b][0]]=[];for(var a=0;a<drawla[b][4].length;a++){ineqtypes[canvases[b][0]][a]=drawla[b][4][a][0];ineqlines[canvases[b][0]][a]=[drawla[b][4][a].slice(1,3),drawla[b][4][a].slice(3,5),drawla[b][4][a].slice(5)]}}}addTarget(canvases[b][0],"canvas"+canvases[b][0],imasroot+"/filter/graph/imgs/"+canvases[b][1],"qn"+canvases[b][0],canvases[b][2],canvases[b][3],canvases[b][4],canvases[b][5],canvases[b][6],canvases[b][7],canvases[b][8],canvases[b][9],canvases[b][10])}}document.onmousedown=drawMouseDown;document.onmouseup=drawMouseUp;document.onmousemove=drawMouseMove;if(typeof(initstack)!="undefined"){initstack.push(initCanvases)}else{if(typeof window.addEventListener!="undefined"){window.addEventListener("load",initCanvases,false)}else{if(typeof document.addEventListener!="undefined"){document.addEventListener("load",initCanvases,false)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onload",initCanvases)}else{if(typeof window.onload=="function"){var existing=onload;window.onload=function(){existing();initCanvases()}}else{window.onload=initCanvases}}}}};